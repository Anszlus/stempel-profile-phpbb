{% if STEMPEL_NOTIFICATION_ENABLED %}
<!-- LATTE -->
    {% if STEMPEL_USER_VERIFIED %}
        <li
            id="stempel_dropdown"
            class="tab stempel_messages {% if STEMPEL_NOTIFICATIONS_COUNT > 0 %}non-zero{% endif %} dropdown-container"
            data-skip-responsive="true"
            data-select="stempel"
            role="menu"
            data-responsive-index="-1">
            <a
                href="{{ STEMPEL_NOTIFICATION_URL }}"
                id="stempel_messages_button"
                class="nav-link dropdown-trigger dropdown-toggle"
                title="Powiadomienia Stempel"
                role="button"
                aria-haspopup="true">
                <svg
                    viewBox="0 0 512 512"
                    height="20"
                    width="20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M369.237 105.372c20.245 0 35.187 6.615 44.82 19.84 9.634 13.224 14.453 31.76 14.453 55.596 0 11.758-1.96 32.003-5.879 60.74-4.244 26.778-6.368 47.188-6.368 61.23 0 8.491 2.449 12.735 7.346 12.735 8.492 0 16.33-12.9 23.515-38.696l26.942 7.839c-2.284 10.776-6.614 22.04-12.982 33.798-6.368 11.758-14.78 21.799-25.232 30.122-10.451 8.324-22.534 12.49-36.243 12.49-17.308 0-29.309-4.573-36.005-13.718-6.696-9.145-10.078-23.022-10.078-41.637 0-14.695 2.285-39.677 6.857-74.95l3.184-28.655c1.47-13.55 2.202-23.926 2.202-31.104 0-7.51-.978-12.817-2.937-15.919-1.96-3.102-5.55-4.655-10.776-4.655-9.47 0-19.35 9.063-29.637 27.185-10.287 18.122-18.857 40.413-25.755 66.862-6.898 26.449-10.287 50.942-10.287 73.475 0 12.736.485 25.307 1.47 37.718h-63.192c-.978-9.145-1.47-20.081-1.47-32.82 0-19.268 1.06-39.514 3.183-60.74l3.673-36.737c2.938-26.453 4.405-44.574 4.405-54.372 0-7.51-1.06-12.818-3.184-15.92-2.124-3.102-5.636-4.654-10.534-4.654-9.47 0-19.596 9.305-30.368 27.92-10.772 18.614-19.756 41.308-26.942 68.082-7.185 26.774-10.776 51.435-10.776 73.965 0 7.838.486 19.596 1.471 35.272H91.495c-.978-9.144-1.47-16.983-1.47-23.515 0-10.451 1.142-25.755 3.434-45.799l7.353-59.027 3.919-32.085c1.96-15.513 2.937-26.042 2.937-31.596 0-8.492-2.284-12.736-6.856-12.736-8.492 0-16.33 12.9-23.516 38.696l-26.941-7.839c4.244-19.596 11.51-37.228 21.798-52.901 10.287-15.674 24.896-23.516 43.84-23.516 12.081 0 21.962 3.434 29.636 10.287 7.674 6.853 11.511 18.29 11.511 34.288 0 6.203-.373 12-1.224 17.394l-1.717 12h.485c10.451-27.106 23.187-46.21 38.207-57.31 15.02-11.1 30.697-16.655 47.023-16.655 15.677 0 27.595 4.897 35.758 14.695 8.163 9.798 12.243 23.676 12.243 41.637 0 7.51-.325 13.389-.978 17.633h.485c19.268-49.307 46.534-73.965 81.803-73.965"></path>
                </svg>
            </a>
            <strong>
                <span class="counter">{{ STEMPEL_NOTIFICATIONS_COUNT }}</span>
                <span class="arrow"></span>
            </strong>

            <div
                id="stempel_dropdown_menu"
                class="dropdown hidden dropdown-extended"
                role="menu">
                <div class="pointer"><div class="pointer-inner"></div></div>
                <div class="dropdown-contents" tabindex="-1" role="dialog">
                    <div class="header">
                        <span>Stempel</span>
                        <span class="header_settings">
                            <a href="{{ STEMPEL_CHAT_URL }}">Czaty</a>
                        </span>
                    </div>
                    <ul>
                        {% for notification in STEMPEL_NOTIFICATIONS %}
                            <li class="dropdown-notification stempel-notification">
                                <a class="notification-block" href="{{ notification.URL }}" target="_blank">
                                    {{ notification.AVATAR }}			
                                    <div class="notification_text">
                                        <p class="notification-title">
                                            {{ notification.FORMATTED_TITLE }}
                                        </p>
                                        <p class="notification-reference">
                                            {{ notification.REFERENCE }}
                                        </p>																	
                                        <div class="notify-footer">
                                            <div class="country">
                                                <img class="flag_global" 
                                                    style="height: 14px !important;" 
                                                    src="{{ notification.COUNTRY_FLAG }}"
                                                    alt="{{ notification.COUNTRY_NAME }}">
                                                <span>
                                                    {{ notification.COUNTRY_NAME }}
                                                </span>
                                            </div>
                                            <div class="stempel-notification-time" data-timestamp="{{ notification.TIMESTAMP }}">
                                                {{ notification.TIMESTAMP|date("Y-m-d H:i") }}
                                            </div>
                                        </div>
                                    </div>
                                  </a>									
                                  <div class="mark_as_read" onclick="stempel_notify_mark_as_read('{{ notification.MARK_AS_READ_URL }}', this)" title="Oznacz jako przeczytane">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M480 96C515.3 96 544 124.7 544 160L544 480C544 515.3 515.3 544 480 544L160 544C124.7 544 96 515.3 96 480L96 160C96 124.7 124.7 96 160 96L480 96zM160 144C151.2 144 144 151.2 144 160L144 480C144 488.8 151.2 496 160 496L480 496C488.8 496 496 488.8 496 480L496 160C496 151.2 488.8 144 480 144L160 144zM390.7 233.9C398.5 223.2 413.5 220.8 424.2 228.6C434.9 236.4 437.3 251.4 429.5 262.1L307.4 430.1C303.3 435.8 296.9 439.4 289.9 439.9C282.9 440.4 276 437.9 271.1 433L215.2 377.1C205.8 367.7 205.8 352.5 215.2 343.2C224.6 333.9 239.8 333.8 249.1 343.2L285.1 379.2L390.7 234z"/></svg>
                                  </div>
                            </li>
                        {% else %}
                            <li class="notification-none">
                                <a href="#">Nie masz powiadomień</a>
                            </li>
                        {% endfor %}
                    </ul>
                    <div class="footer">
                        <a href="{{ STEMPEL_NOTIFICATION_URL }}">
                            Zobacz wszystkie
                        </a>
                    </div>
                </div>
            </div>
        </li>
    {% elseif STEMPEL_VERIFICATION_LINK %}
        <li
            id="stempel_dropdown"
            class="tab stempel_messages"
            data-skip-responsive="true"
            data-select="stempel"
            role="menu"
            data-responsive-index="-1">
            <a
                href="{STEMPEL_NOTIFICATION_URL}"
                id="stempel_messages_button"
                class="nav-link"
                title="Powiadomienia Stempel"
                role="button"
                aria-haspopup="true">
                <svg
                    viewBox="0 0 512 512"
                    height="20"
                    width="20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M369.237 105.372c20.245 0 35.187 6.615 44.82 19.84 9.634 13.224 14.453 31.76 14.453 55.596 0 11.758-1.96 32.003-5.879 60.74-4.244 26.778-6.368 47.188-6.368 61.23 0 8.491 2.449 12.735 7.346 12.735 8.492 0 16.33-12.9 23.515-38.696l26.942 7.839c-2.284 10.776-6.614 22.04-12.982 33.798-6.368 11.758-14.78 21.799-25.232 30.122-10.451 8.324-22.534 12.49-36.243 12.49-17.308 0-29.309-4.573-36.005-13.718-6.696-9.145-10.078-23.022-10.078-41.637 0-14.695 2.285-39.677 6.857-74.95l3.184-28.655c1.47-13.55 2.202-23.926 2.202-31.104 0-7.51-.978-12.817-2.937-15.919-1.96-3.102-5.55-4.655-10.776-4.655-9.47 0-19.35 9.063-29.637 27.185-10.287 18.122-18.857 40.413-25.755 66.862-6.898 26.449-10.287 50.942-10.287 73.475 0 12.736.485 25.307 1.47 37.718h-63.192c-.978-9.145-1.47-20.081-1.47-32.82 0-19.268 1.06-39.514 3.183-60.74l3.673-36.737c2.938-26.453 4.405-44.574 4.405-54.372 0-7.51-1.06-12.818-3.184-15.92-2.124-3.102-5.636-4.654-10.534-4.654-9.47 0-19.596 9.305-30.368 27.92-10.772 18.614-19.756 41.308-26.942 68.082-7.185 26.774-10.776 51.435-10.776 73.965 0 7.838.486 19.596 1.471 35.272H91.495c-.978-9.144-1.47-16.983-1.47-23.515 0-10.451 1.142-25.755 3.434-45.799l7.353-59.027 3.919-32.085c1.96-15.513 2.937-26.042 2.937-31.596 0-8.492-2.284-12.736-6.856-12.736-8.492 0-16.33 12.9-23.516 38.696l-26.941-7.839c4.244-19.596 11.51-37.228 21.798-52.901 10.287-15.674 24.896-23.516 43.84-23.516 12.081 0 21.962 3.434 29.636 10.287 7.674 6.853 11.511 18.29 11.511 34.288 0 6.203-.373 12-1.224 17.394l-1.717 12h.485c10.451-27.106 23.187-46.21 38.207-57.31 15.02-11.1 30.697-16.655 47.023-16.655 15.677 0 27.595 4.897 35.758 14.695 8.163 9.798 12.243 23.676 12.243 41.637 0 7.51-.325 13.389-.978 17.633h.485c19.268-49.307 46.534-73.965 81.803-73.965"></path>
                </svg>
            </a>
        </li>
    {% endif %}
<style>
    .navbar .nav-tabs .stempel_messages .nav-link {
        position: relative;
        padding-left: 30px;
        display: inline-flex;
        justify-content: center;
        align-items: center;
        fill: currentColor;
        width: 14px;
        padding: 0 8px;
        overflow: hidden;
        text-indent: 9999px;
    }

    .navbar .nav-tabs .stempel_messages .nav-link + strong {
        right: -2px;
    }

    .nav-tabs .stempel_messages .nav-link svg {
        fill: currentColor;
        width: 20px;
        height: 20px;
        flex-shrink: 0;
    }

    .navbar .inner.static .nav-tabs .tab > strong {
        position: relative;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        vertical-align: top;
        margin-top: 8px;
        margin-left: -7px;
        margin-right: 5px;
        padding-bottom: 1px;
        pointer-events: none;
    }

    li.stempel-notification {
        display: flex;
        flex-direction: row;
        width: 100%;
    }

    li.stempel-notification > a {
        flex: 1;
    }
    
    li.stempel-notification .mark_as_read {
        width: 30px;
        background: #ffffff10;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-shrink: 0;
        cursor: pointer;
        opacity: 0.2;
        transition: opacity 0.3s;
		}

		li.stempel-notification .mark_as_read:hover {
			  opacity: 1;
		}
    li.stempel-notification .mark_as_read svg {
      width: 24px;
    }

    li.stempel-notification img.avatar {
        float: left;
        max-height: 50px;
        max-width: 50px;
        aspect-ratio: 1;
        object-fit: contain;
        filter: drop-shadow(0 0 0.75rem #b0b0b0);
    }

    li.stempel-notification p {
        margin-bottom: 4px;
        font-size: 11px;
    }

    li.stempel-notification p.notification-reference {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .stempel-notification .notification_text > .notify-footer {
        font-size: 10px;
        display:flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
    }

    .stempel-notification .notification_text > .notify-footer > .country {
        display: flex;
        flex-direction: row;
        justify-content: start;
        align-items: center;
        gap: 4px;
        flex: 1;
        color: #252424;
    }

    .stempel-notification .notification_text > .notify-footer > .stempel-notification-time {
        color: #757575;
        text-align: right;
        flex: 1;
    }
</style>

<script>
    function stempelTimeAgo(timestamp) {
        const diff = Math.floor(Date.now() / 1000) - timestamp;

        if (diff < 60) return "przed chwilą";
        if (diff < 3600) return Math.floor(diff / 60) + " min temu";
        if (diff < 86400) return Math.floor(diff / 3600) + " godz temu";
        return Math.floor(diff / 86400) + " dni temu";
    }

    document.querySelectorAll(".stempel-notification-time").forEach(el => {
        const ts = parseInt(el.dataset.timestamp, 10);
        el.textContent = stempelTimeAgo(ts);
    });

    function stempel_notify_mark_as_read(mark_as_read_url, el) {
      fetch(mark_as_read_url).then(response => {
        const li = el.closest("li");
        if (li) {
          li.remove();
        }
      });
    }
</script>
{% endif %}
